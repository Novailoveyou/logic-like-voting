// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../dist/generated/prisma"
}

// // @TODO: make this generator work with imports
// generator zod {
//   provider = "zod-prisma"
//   output   = "../../docs/generated/zod" // (default) the directory where generated zod schemas will be saved

//   // TODO: make this work .refine(imports.isURL)
//   // imports  = "../zod-schemas"

//   relationModel = true // (default) Create and export both plain and related models.
//   // relationModel         = "default" // Do not export model without relations.
//   // relationModel         = false // Do not generate related model

//   modelCase = "PascalCase" // (default) Output models using pascal case (ex. UserModel, PostModel)
//   // modelCase             = "camelCase" // Output models using camel case (ex. userModel, postModel)

//   modelSuffix = "Model" // (default) Suffix to apply to your prisma models when naming Zod schemas

//   // useDecimalJs          = false // (default) represent the prisma Decimal type using as a JS number
//   useDecimalJs = true // represent the prisma Decimal type using Decimal.js (as Prisma does)

//   // https://www.prisma.io/docs/concepts/components/prisma-client/working-with-fields/working-with-json-fields#filtering-by-null-values
//   prismaJsonNullability = true // (default) uses prisma's scheme for JSON field nullability
//   // prismaJsonNullability = false // allows null assignment to optional JSON fields
// }

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Idea {
  /// The unique identifier for the record
  /// @default {Generated by database}
  id String @id @unique @default(uuid())

  /// createdAt survivor date at the request time
  /// @zod.custom(z.coerce.date())
  createdAt DateTime @default(now()) @map(name: "created_at")

  /// updatedAt survivor date at the request time
  /// @zod.custom(z.coerce.date())
  updatedAt DateTime @default(now()) @updatedAt @map(name: "updated_at")

  /// idea title
  /// @zod.trim().min(1, { message: "Название должно быть больше 1-го символа" }).max(256, { message: "Название должно быть меньше 256-и символов" })
  title String

  /// idea description
  /// @zod.trim().min(1, { message: "Описание должно быть больше 1-го символа" }).max(1024, { message: "Описание должно быть меньше 1024-х символов" })
  description String

  votes Vote[]

  @@map("ideas")
}

model User {
  /// The unique identifier for the record
  /// @default {Generated by database}
  id String @id @unique @default(uuid())

  /// createdAt survivor date at the request time
  /// @zod.custom(z.coerce.date())
  createdAt DateTime @default(now()) @map(name: "created_at")

  /// updatedAt survivor date at the request time
  /// @zod.custom(z.coerce.date())
  updatedAt DateTime @default(now()) @updatedAt @map(name: "updated_at")

  /// user ip
  /// @zod.trim().min(7, { message: "IP должно быть больше 7-го символа" }).max(128, { message: "IP должно быть меньше 128-и символов" })
  ip String @unique

  votes Vote[]

  @@map("users")
}

model Vote {
  /// The unique identifier for the record
  /// @default {Generated by database}
  id String @id @unique @default(uuid())

  /// createdAt survivor date at the request time
  /// @zod.custom(z.coerce.date())
  createdAt DateTime @default(now()) @map(name: "created_at")

  /// updatedAt survivor date at the request time
  /// @zod.custom(z.coerce.date())
  updatedAt DateTime @default(now()) @updatedAt @map(name: "updated_at")

  /// vote value
  /// @zod.int().min(1, { message: "Голос должен быть больше или равен 1" }).max(10, { message: "Голос должен быть меньше или равен 10" })
  value Int

  /// vote userIp
  userIp String
  user   User   @relation(fields: [userIp], references: [ip])

  /// vote ideaIp
  ideaId String
  idea   Idea   @relation(fields: [ideaId], references: [id])

  @@map("votes")
}
